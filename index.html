<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Clima Tempo</title>
    <link rel="stylesheet" href="styles.css" />

    <link rel="preconnect" href="https://fonts.googleapis.com" />
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
    <link
      href="https://fonts.googleapis.com/css2?family=Poppins:ital,wght@0,100;0,200;0,300;0,400;0,500;0,600;0,700;0,800;0,900;1,100;1,200;1,300;1,400;1,500;1,600;1,700;1,800;1,900&display=swap"
      rel="stylesheet"
    />
  </head>
  <body>
    <div class="container">
      <!-- <div class="clima-results-box">
        <p id="city-info"></p>
        <p id="weather-info"></p>
      </div> -->

      <div class="search-container weather-card" id="weather-card">
        <h1 id="search-title">Clima Tempo</h1>
        <h1 id="search-title-second">Digite o nome da cidade</h1>
        <p class="search-paragraphy sp-top">
          Veja as condições atuais do tempo na <br />cidade.
        </p>
        <div class="search-box">
          <input type="text" id="city" placeholder="Digite o nome da cidade" />
          <button onclick="getWeather()">Pesquisar</button>
        </div>
        <p class="search-paragraphy sp-bottom">
          Dados meteorológicos atualizados para <br />
          se manter informado sobre o clima.
        </p>

        <div class="container weather-container" id="weather-container">
          <div class="box-results-temp">
            <div class="clima-results-head">
              <div class="temp-result-box">
                <img id="icon-info" />
                <p id="temp-info"></p>
              </div>
              <p id="description-info"></p>
            </div>
          </div>
          <div class="results-bottom">
            <div class="results-text-bottom r-border-text">
              <p>Chuva</p>
              <p id="rain-info"></p>
            </div>
            <div class="results-text-bottom r-border-text">
              <p>Umidade</p>
              <p id="humidity-info"></p>
            </div>
            <div class="results-text-bottom ml-1">
              <p>Vento</p>
              <p id="wind-info"></p>
            </div>
          </div>
        </div>
      </div>
      <p id="erro-info"></p>

      <script>
        async function getWeather() {
          const city = document.getElementById("city").value;
          const apiKey = "cc522f8802c0773cf056c064fa52165d";
          const lang = "pt_br";
          const url = `https://api.openweathermap.org/data/2.5/weather?q=${city}&appid=${apiKey}&lang=${lang}&units=metric`;

          try {
            const response = await fetch(url);
            const data = await response.json();

            if (data.cod === 200) {
              const weather = data.weather[0].main.toLowerCase();
              const temp = data.main.temp;
              const rain = data.rain ? data.rain["1h"] : 0;
              const rainPercentage = rain > 0 ? Math.min(rain * 10, 100) : 0;
              const humidity = data.main.humidity;
              const wind = data.wind.speed;
              const description = data.weather[0].description;
              const icon = data.weather[0].icon;
              const iconUrl = `https://openweathermap.org/img/wn/${icon}@2x.png`;

              document.getElementById("weather-container").style =
                "display:block";
              document.getElementById("search-title").style = "display:none";
              document.getElementById("search-title-second").style =
                "display:block";
              document.getElementById("erro-info").style = "display:none";
              document
                .querySelectorAll(".search-paragraphy")
                .forEach((item) => (item.style.display = "none"));

              // document.getElementById("city-info").textContent = `${city}`;
              // document.getElementById(
              //   "weather-info"
              // ).textContent = `${weather}`;
              document.getElementById("temp-info").textContent = `${Math.round(
                temp
              )} °C`;
              document.getElementById("rain-info").textContent = `${rain}%`;
              document.getElementById(
                "humidity-info"
              ).textContent = `${humidity}%`;
              document.getElementById("wind-info").textContent = `${Math.round(
                wind
              )} km/h`;
              document.getElementById(
                "description-info"
              ).textContent = `${description}`;
              document.getElementById("icon-info").src = iconUrl;

              changeBackground(weather);
            } else {
              document.getElementById("erro-info").style = "display:block";
              document.getElementById("erro-info").textContent =
                "Cidade não encontrada. Tente novamente.";
            }
          } catch (error) {
            document.getElementById("erro-info").style = "display:block";
            console.error(error);
            document.getElementById("erro-info").textContent =
              "Erro ao buscar dados meteorológicos. Tente novamente mais tarde";
          }
        }

        function changeBackground(weather) {
          const body = document.body;
          switch (weather) {
            case "clear":
              body.style.backgroundColor = "#87CEEB";
              break;
            case "clouds":
              body.style.backgroundColor = "#B0C4DE";
              break;
            case "rain":
            case "drizzle":
              body.style.backgroundColor = "#708090";
              break;
            case "thunderstorm":
              body.style.backgroundColor = "#2F4F4F";
              break;
            case "snow":
              body.style.backgroundColor = "#FFFFFF";
              break;
            default:
              body.style.backgroundColor = "#2E2E2E";
          }
        }
      </script>
    </div>
  </body>
</html>
